name: Update LICENSE from Wizard

on:
  workflow_dispatch:
    inputs:
      license_text:
        description: "Paste the full LICENSE text generated by the Wizard"
        required: true
        type: string

  repository_dispatch:
    types: [update_license]

permissions:
  contents: write

jobs:
  inject-license:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Validate input
        id: validate
        run: |
          if [ -z "${{ github.event.inputs.license_text }}" ]; then
            echo "❌ ERROR: No license text provided."
            exit 1
          fi
          echo "✔ LICENSE text received."

      - name: Write LICENSE file
        id: write
        run: |
          echo "${{ github.event.inputs.license_text }}" > LICENSE
          echo "✔ LICENSE file updated."

      - name: Commit changes
        id: commit
        run: |
          git config user.name "license-bot"
          git config user.email "noreply@github.com"

          git add LICENSE
          git commit -m "Update LICENSE via License Wizard" || echo "No changes to commit"

      - name: Push changes
        id: push
        run: |
          git push
          echo "✔ LICENSE pushed to repository."
